import math

import rlmath
from rlmath import Hex

from RLUtilities.LinearAlgebra import vec3


TILE_WIDTH = 768
TILE_SIZE = TILE_WIDTH / math.sqrt(3)
TILE_HEIGHT = TILE_SIZE * 2
TILE_COUNT = 140

MIDDLE_OFFSET = 128
Q_VEC = vec3(-TILE_WIDTH, 0, 0)
R_VEC = vec3(-TILE_WIDTH / 2, 0.75 * TILE_HEIGHT, 0)


class Tile:

    UNKNOWN = 0
    FILLED = 1
    DAMAGED = 2
    OPEN = 3

    def __init__(self, location, hex, team):
        self.location = location
        self.hex = hex
        self.team = team
        self.state = Tile.UNKNOWN


def point_to_tile(info, point):
    if point[1] > 0:
        point = point - vec3(0, MIDDLE_OFFSET, 0)
    else:
        point = point - vec3(0, -MIDDLE_OFFSET, 0)
    hex = point_to_hex(point)
    if hex in info.tile_dict:
        return info.tile_dict[hex]
    return None


def point_to_hex(point):
    q = -point[0] / TILE_WIDTH - point[1] * 2 / (3 * TILE_HEIGHT)
    r = point[1] * 4 / (3 * TILE_HEIGHT)
    return rlmath.hex_from_rounding(q, r)


ALL_TILES = [
            Tile(vec3(-2304.0, -4117.4287109375, 2.5), Hex(6, -6), 0),
            Tile(vec3(-1536.0, -4117.4287109375, 2.5), Hex(5, -6), 0),
            Tile(vec3(-768.0, -4117.4287109375, 2.5), Hex(4, -6), 0),
            Tile(vec3(0.0, -4117.4287109375, 2.5), Hex(3, -6), 0),
            Tile(vec3(768.0, -4117.4287109375, 2.5), Hex(2, -6), 0),
            Tile(vec3(1536.0, -4117.4287109375, 2.5), Hex(1, -6), 0),
            Tile(vec3(2304.0, -4117.4287109375, 2.5), Hex(0, -6), 0),
            Tile(vec3(-2688.0, -3452.322021484375, 2.5), Hex(6, -5), 0),
            Tile(vec3(-1920.0, -3452.322021484375, 2.5), Hex(5, -5), 0),
            Tile(vec3(-1152.0, -3452.322021484375, 2.5), Hex(4, -5), 0),
            Tile(vec3(-384.0, -3452.322021484375, 2.5), Hex(3, -5), 0),
            Tile(vec3(384.0, -3452.322021484375, 2.5), Hex(2, -5), 0),
            Tile(vec3(1152.0, -3452.322021484375, 2.5), Hex(1, -5), 0),
            Tile(vec3(1920.0, -3452.322021484375, 2.5), Hex(0, -5), 0),
            Tile(vec3(2688.0, -3452.322021484375, 2.5), Hex(-1, -5), 0),
            Tile(vec3(-3072.0, -2788.428955078125, 2.5), Hex(6, -4), 0),
            Tile(vec3(-2304.0, -2788.428955078125, 2.5), Hex(5, -4), 0),
            Tile(vec3(-1536.0, -2788.428955078125, 2.5), Hex(4, -4), 0),
            Tile(vec3(-768.0, -2788.428955078125, 2.5), Hex(3, -4), 0),
            Tile(vec3(0.0, -2788.428955078125, 2.5), Hex(2, -4), 0),
            Tile(vec3(768.0, -2788.428955078125, 2.5), Hex(1, -4), 0),
            Tile(vec3(1536.0, -2788.428955078125, 2.5), Hex(0, -4), 0),
            Tile(vec3(2304.0, -2788.428955078125, 2.5), Hex(-1, -4), 0),
            Tile(vec3(3072.0, -2788.428955078125, 2.5), Hex(-2, -4), 0),
            Tile(vec3(-3456.0, -2123.322021484375, 2.5), Hex(6, -3), 0),
            Tile(vec3(-2688.0, -2123.322021484375, 2.5), Hex(5, -3), 0),
            Tile(vec3(-1920.0, -2123.322021484375, 2.5), Hex(4, -3), 0),
            Tile(vec3(-1152.0, -2123.322021484375, 2.5), Hex(3, -3), 0),
            Tile(vec3(-384.0, -2123.322021484375, 2.5), Hex(2, -3), 0),
            Tile(vec3(384.0, -2123.322021484375, 2.5), Hex(1, -3), 0),
            Tile(vec3(1152.0, -2123.322021484375, 2.5), Hex(0, -3), 0),
            Tile(vec3(1920.0, -2123.322021484375, 2.5), Hex(-1, -3), 0),
            Tile(vec3(2688.0, -2123.322021484375, 2.5), Hex(-2, -3), 0),
            Tile(vec3(3456.0, -2123.322021484375, 2.5), Hex(-3, -3), 0),
            Tile(vec3(-3840.0, -1458.21484375, 2.5), Hex(6, -2), 0),
            Tile(vec3(-3072.0, -1458.21484375, 2.5), Hex(5, -2), 0),
            Tile(vec3(-2304.0, -1458.21484375, 2.5), Hex(4, -2), 0),
            Tile(vec3(-1536.0, -1458.21484375, 2.5), Hex(3, -2), 0),
            Tile(vec3(-768.0, -1458.21484375, 2.5), Hex(2, -2), 0),
            Tile(vec3(0.0, -1458.21484375, 2.5), Hex(1, -2), 0),
            Tile(vec3(768.0, -1458.21484375, 2.5), Hex(0, -2), 0),
            Tile(vec3(1536.0, -1458.21484375, 2.5), Hex(-1, -2), 0),
            Tile(vec3(2304.0, -1458.21484375, 2.5), Hex(-2, -2), 0),
            Tile(vec3(3072.0, -1458.21484375, 2.5), Hex(-3, -2), 0),
            Tile(vec3(3840.0, -1458.21484375, 2.5), Hex(-4, -2), 0),
            Tile(vec3(-4224.0, -793.1079711914062, 2.5), Hex(6, -1), 0),
            Tile(vec3(-3456.0, -793.1079711914062, 2.5), Hex(5, -1), 0),
            Tile(vec3(-2688.0, -793.1079711914062, 2.5), Hex(4, -1), 0),
            Tile(vec3(-1920.0, -793.1079711914062, 2.5), Hex(3, -1), 0),
            Tile(vec3(-1152.0, -793.1079711914062, 2.5), Hex(2, -1), 0),
            Tile(vec3(-384.0, -793.1079711914062, 2.5), Hex(1, -1), 0),
            Tile(vec3(384.0, -793.1079711914062, 2.5), Hex(0, -1), 0),
            Tile(vec3(1152.0, -793.1079711914062, 2.5), Hex(-1, -1), 0),
            Tile(vec3(1920.0, -793.1079711914062, 2.5), Hex(-2, -1), 0),
            Tile(vec3(2688.0, -793.1079711914062, 2.5), Hex(-3, -1), 0),
            Tile(vec3(3456.0, -793.1079711914062, 2.5), Hex(-4, -1), 0),
            Tile(vec3(4224.0, -793.1079711914062, 2.5), Hex(-5, -1), 0),
            Tile(vec3(-4608.0, -127.99998474121094, 2.5), Hex(6, 0), 0),
            Tile(vec3(-3840.0, -127.99998474121094, 2.5), Hex(5, 0), 0),
            Tile(vec3(-3072.0, -127.99998474121094, 2.5), Hex(4, 0), 0),
            Tile(vec3(-2304.0, -127.99998474121094, 2.5), Hex(3, 0), 0),
            Tile(vec3(-1536.0, -127.99998474121094, 2.5), Hex(2, 0), 0),
            Tile(vec3(-768.0, -127.99998474121094, 2.5), Hex(1, 0), 0),
            Tile(vec3(0.0, -127.99998474121094, 2.5), Hex(0, 0), 0),
            Tile(vec3(768.0, -127.99998474121094, 2.5), Hex(-1, 0), 0),
            Tile(vec3(1536.0, -127.99998474121094, 2.5), Hex(-2, 0), 0),
            Tile(vec3(2304.0, -128.0, 2.5), Hex(-3, 0), 0),
            Tile(vec3(3072.0, -127.99998474121094, 2.5), Hex(-4, 0), 0),
            Tile(vec3(3840.0, -127.99998474121094, 2.5), Hex(-5, 0), 0),
            Tile(vec3(4608.0, -127.99998474121094, 2.5), Hex(-6, 0), 0),
            Tile(vec3(-4608.0, 128.0, 2.5), Hex(6, 0), 1),
            Tile(vec3(-3840.0, 128.0, 2.5), Hex(5, 0), 1),
            Tile(vec3(-3072.0, 128.0, 2.5), Hex(4, 0), 1),
            Tile(vec3(-2304.0, 128.0, 2.5), Hex(3, 0), 1),
            Tile(vec3(-1536.0, 128.0, 2.5), Hex(2, 0), 1),
            Tile(vec3(-768.0, 128.0, 2.5), Hex(1, 0), 1),
            Tile(vec3(0.0, 128.0, 2.5), Hex(0, 0), 1),
            Tile(vec3(768.0, 128.0, 2.5), Hex(-1, 0), 1),
            Tile(vec3(1536.0, 128.0, 2.5), Hex(-2, 0), 1),
            Tile(vec3(2304.0, 128.0, 2.5), Hex(-3, 0), 1),
            Tile(vec3(3072.0, 128.0, 2.5), Hex(-4, 0), 1),
            Tile(vec3(3840.0, 128.0, 2.5), Hex(-5, 0), 1),
            Tile(vec3(4608.0, 128.0, 2.5), Hex(-6, 0), 1),
            Tile(vec3(-4224.0, 793.1079711914062, 2.5), Hex(5, 1), 1),
            Tile(vec3(-3456.0, 793.1079711914062, 2.5), Hex(4, 1), 1),
            Tile(vec3(-2688.0, 793.1079711914062, 2.5), Hex(3, 1), 1),
            Tile(vec3(-1920.0, 793.1079711914062, 2.5), Hex(2, 1), 1),
            Tile(vec3(-1152.0, 793.1079711914062, 2.5), Hex(1, 1), 1),
            Tile(vec3(-384.0, 793.1079711914062, 2.5), Hex(0, 1), 1),
            Tile(vec3(384.0, 793.1079711914062, 2.5), Hex(-1, 1), 1),
            Tile(vec3(1152.0, 793.1079711914062, 2.5), Hex(-2, 1), 1),
            Tile(vec3(1920.0, 793.1079711914062, 2.5), Hex(-3, 1), 1),
            Tile(vec3(2688.0, 793.1079711914062, 2.5), Hex(-4, 1), 1),
            Tile(vec3(3456.0, 793.1079711914062, 2.5), Hex(-5, 1), 1),
            Tile(vec3(4224.0, 793.1079711914062, 2.5), Hex(-6, 1), 1),
            Tile(vec3(-3840.0, 1458.21484375, 2.5), Hex(4, 2), 1),
            Tile(vec3(-3072.0, 1458.21484375, 2.5), Hex(3, 2), 1),
            Tile(vec3(-2304.0, 1458.21484375, 2.5), Hex(2, 2), 1),
            Tile(vec3(-1536.0, 1458.21484375, 2.5), Hex(1, 2), 1),
            Tile(vec3(-768.0, 1458.21484375, 2.5), Hex(0, 2), 1),
            Tile(vec3(0.0, 1458.21484375, 2.5), Hex(-1, 2), 1),
            Tile(vec3(768.0, 1458.21484375, 2.5), Hex(-2, 2), 1),
            Tile(vec3(1536.0, 1458.21484375, 2.5), Hex(-3, 2), 1),
            Tile(vec3(2304.0, 1458.21484375, 2.5), Hex(-4, 2), 1),
            Tile(vec3(3072.0, 1458.21484375, 2.5), Hex(-5, 2), 1),
            Tile(vec3(3840.0, 1458.21484375, 2.5), Hex(-6, 2), 1),
            Tile(vec3(-3456.0, 2123.322021484375, 2.5), Hex(3, 3), 1),
            Tile(vec3(-2688.0, 2123.322021484375, 2.5), Hex(2, 3), 1),
            Tile(vec3(-1920.0, 2123.322021484375, 2.5), Hex(1, 3), 1),
            Tile(vec3(-1152.0, 2123.322021484375, 2.5), Hex(0, 3), 1),
            Tile(vec3(-384.0, 2123.322021484375, 2.5), Hex(-1, 3), 1),
            Tile(vec3(384.0, 2123.322021484375, 2.5), Hex(-2, 3), 1),
            Tile(vec3(1152.0, 2123.322021484375, 2.5), Hex(-3, 3), 1),
            Tile(vec3(1920.0, 2123.322021484375, 2.5), Hex(-4, 3), 1),
            Tile(vec3(2688.0, 2123.322021484375, 2.5), Hex(-5, 3), 1),
            Tile(vec3(3456.0, 2123.322021484375, 2.5), Hex(-6, 3), 1),
            Tile(vec3(-3072.0, 2788.428955078125, 2.5), Hex(2, 4), 1),
            Tile(vec3(-2304.0, 2788.428955078125, 2.5), Hex(1, 4), 1),
            Tile(vec3(-1536.0, 2788.428955078125, 2.5), Hex(0, 4), 1),
            Tile(vec3(-768.0, 2788.428955078125, 2.5), Hex(-1, 4), 1),
            Tile(vec3(0.0, 2788.428955078125, 2.5), Hex(-2, 4), 1),
            Tile(vec3(768.0, 2788.428955078125, 2.5), Hex(-3, 4), 1),
            Tile(vec3(1536.0, 2788.428955078125, 2.5), Hex(-4, 4), 1),
            Tile(vec3(2304.0, 2788.428955078125, 2.5), Hex(-5, 4), 1),
            Tile(vec3(3072.0, 2788.428955078125, 2.5), Hex(-6, 4), 1),
            Tile(vec3(-2688.0, 3452.322021484375, 2.5), Hex(1, 5), 1),
            Tile(vec3(-1920.0, 3452.322021484375, 2.5), Hex(0, 5), 1),
            Tile(vec3(-1152.0, 3452.322021484375, 2.5), Hex(-1, 5), 1),
            Tile(vec3(-384.0, 3452.322021484375, 2.5), Hex(-2, 5), 1),
            Tile(vec3(384.0, 3452.322021484375, 2.5), Hex(-3, 5), 1),
            Tile(vec3(1152.0, 3452.322021484375, 2.5), Hex(-4, 5), 1),
            Tile(vec3(1920.0, 3452.322021484375, 2.5), Hex(-5, 5), 1),
            Tile(vec3(2688.0, 3452.322021484375, 2.5), Hex(-6, 5), 1),
            Tile(vec3(-2304.0, 4117.4287109375, 2.5), Hex(0, 6), 1),
            Tile(vec3(-1536.0, 4117.4287109375, 2.5), Hex(-1, 6), 1),
            Tile(vec3(-768.0, 4117.4287109375, 2.5), Hex(-2, 6), 1),
            Tile(vec3(0.0, 4117.4287109375, 2.5), Hex(-3, 6), 1),
            Tile(vec3(768.0, 4117.4287109375, 2.5), Hex(-4, 6), 1),
            Tile(vec3(1536.0, 4117.4287109375, 2.5), Hex(-5, 6), 1),
            Tile(vec3(2304.0, 4117.4287109375, 2.5), Hex(-6, 6), 1)
]
